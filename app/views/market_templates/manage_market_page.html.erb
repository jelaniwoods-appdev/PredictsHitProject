<div class="row">   
  <div class="col-1">
    <div class="center_title"><button class="btn btn-outline-secondary btn-block" id="menu-toggle">Season Standings</button></div>
    <br>
    <% if @owner_user_id == current_user.id %>
      <div class="center_title"><a class="btn btn-outline-secondary btn-block" href="/markets/<%= @club_row.id %>/<%= @season_row.id %>/<%= @market_row.id %>">View Market</a></div>
      <br>
    <% end %>
    <% if @market_row.status == "active" %>
      <div class="center_title"><a class="btn btn-outline-secondary btn-block" href="/markets/manage/close/<%= @club_row.id %>/<%= @season_row.id %>/<%= @market_row.id %>">Close Market</a></div>
    <% end %>
  </div>
  <div>
    <div class="d-flex" id="wrapper">
      <!-- Sidebar -->
      <div id="sidebar-wrapper">
        <h2 class="center_title">Season Standings</h2>
        <table class="table table-hover table-striped sortable table-bordered">
          <thead class="thead-dark">
            <tr class="d-flex">
              <th class="col-4 text-center pr-5">
                Username
              </th>

              <th class="col-4 text-center pr-5">
                Role
              </th>

              <th class="col-4 text-center pr-5">
                Funds
              </th>

            </tr>
          </thead>

          <% @membership_rows.each do |member| %>
          <tr class="d-flex">
            <td class="col-4 text-center pr-5">
              <a href="/profile/<%= member.users_id %>"><%= member.user.username %></a> 
            </td>
            <td class="col-4 text-center pr-5">
              <%= member.category %>
            </td>
            <td class="col-4 text-center pr-5">
              $<%= member.assets.where({ :category => "season_fund"}).at(0).quantity %>
            </td>
          </tr>
                    
          <% end %>
        </table>
      </div>
      <!-- /#sidebar-wrapper -->

    </div>
    <!-- /#wrapper -->
  </div>
  
  
  <div class="col-6 offset-2"> 
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/my_clubs">My Clubs</a></li>
        <li class="breadcrumb-item"><a href="/clubs/<%= @club_row.id %>"><%= @club_row.title %></a></li>
        <li class="breadcrumb-item"><a href="/seasons/<%= @club_row.id %>/<%= @season_row.id %>"><%= @season_row.title %></a></li>
        <li class="breadcrumb-item"><a href="/markets/<%= @club_row.id %>/<%= @season_row.id %>/<%= @market_row.id %>"><%= @market_row.title %></a></li>
        <li class="breadcrumb-item active" aria-current="page">Manage Market</li>
      </ol>
    </nav>

    <% if @market_row.status == "closed" %>
    <h1 class="center_title">This Market is closed!</h1>
    <% else %>
    <h1 class="center_title">Manage Market</h1>
    <% end %>

    <div class="col-md-8 offset-md-2">
      <div class="jumbotron">
        <h2 class="center_title">Market Details</h2>
          <br>
          <form action="/update_market_details/<%= @club_row.id %>/<%= @season_row.id %>/<%= @market_row.id %>" method="post" enctype="multipart/form-data">
            <div class="form-group">
              <input type="hidden" name="_method" value="patch">
              <label for="update_market_title">What is the new title of your market?</label>
              <input class="form-control" id="update_market_title" type="text" name="updated_market_title" placeholder="Enter a title..." value="<%= @market_row.title %>" required>
              <br>
              <label for="update_market_description">What is the description of your market?</label>
              <input class="form-control" id="update_market_description" type="text" name="updated_market_description" placeholder="Enter a description..." value="<%= @market_row.description %>">
              <br>
              <label for="update_market_picture">What picture would you like to set for your Market?</label>
              <input type="file" id="update_market_picture" name="updated_market_picture" class="form-control">
              <br>
              <br>
              <button class="btn btn-secondary btn-block">Update Market Details</button>
            </div>
          </form>
      </div>
    </div>
    <br>

    <div class="col-md-8 offset-md-2">
      <div class="jumbotron">
        <% if @contract_rows.present? %>
          <h2 class="center_title">Contracts available in <%= @market_row.title %></h2>
          <table class="table table-hover table-striped">
            <thead class="thead-dark">
              <tr>
                <th>
                  Contract Title
                </th>

                <th>
                  Contract Description
                </th>

                <th></th>
              </tr>
            </thead>
            <% @contract_rows.each do |contract| %>
            <tr>
              <td>
                <%= contract.title %>
              </td>

              <td>
                <%= contract.description %>
              </td>

              <td>
                <a class="btn btn-secondary" href="/contracts/<%= contract.market.season.club.id.to_s + '/' + contract.market.season.id.to_s + '/' + contract.market.id.to_s + '/' + contract.id.to_s %>">Go to Contract</a>
              </td>
            </tr>
          
          <% end %>
        </table>
        <% else %>
        <h2>There are no active contracts in this Market.</h2>
        <% end %>
      </div>
    </div>

    <br>
    <div class="col-md-8 offset-md-2">
      <div class="jumbotron">
        <h2 class="center_title">Add Market Contract</h2>
        <br>
          <form action="/add_market_contract/<%= @club_row.id %>/<%= @season_row.id %>/<%= @market_row.id %>" method="post" enctype="multipart/form-data">
            <div class="form-group">
              <label for="new_contract_title">What is the title of the contract you would like to add?</label>
              <input class="form-control" id="new_contract_title" type="text" name="contract_title" placeholder="Enter a title..." required>
              <br>
              <label for="new_contract_description">What is the description of the contract you would like to add?</label>
              <input class="form-control" id="new_contract_description" type="text" name="contract_description" placeholder="Enter a description...">
              <br>
              <label for="new_contract_starting_price">What price would you like to set the contract at initially? <br>Note: Must be a number between $0.00 and $1.00.</label>
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text">$</span>
                </div>
                <input class="form-control" id="new_contract_starting_price" type="number" name="contract_starting_price" min="0.01" step=".01" max="0.99" placeholder="Enter a price between $0.00 and $1.00, exclusive..." required>
              </div>
              <br>
              <label for="create_contract_picture">What picture would you like to set for this Contract?</label>
              <input type="file" id="create_contract_picture" name="contract_picture" class="form-control">
              <br>
              <button class="btn btn-secondary btn-block">Add Contract</button>
            </div>
          </form>
      </div>
    </div>
  </div>
</div>

<script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
</script>
