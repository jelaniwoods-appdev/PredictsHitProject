<div class="row">   
  <div class="col-1">
    <div class="center_title"><button class="btn btn-outline-secondary btn-block" id="menu-toggle">Season Standings</button></div>
    <br>
    <% if @owner_user_id == current_user.id %>
        <div class="center_title"><a class="btn btn-outline-secondary btn-block" href="/seasons/<%= @club_row.id %>/<%= @season_row.id %>">View Season</a></div>
      <br>
    <% end %>
  </div>
  <div>
    <div class="d-flex" id="wrapper">
      <!-- Sidebar -->
      <div id="sidebar-wrapper">
        <h2 class="center_title">Season Standings</h2>
        <table class="table table-hover table-striped sortable table-bordered">
          <thead class="thead-dark">
            <tr class="d-flex">
              <th class="col-4 text-center pr-5" >
                Username
              </th>

              <th class="col-4 text-center pr-5">
                Role
              </th>

              <th class="col-4 text-center pr-5">
                Funds
              </th>

            </tr>
          </thead>

          <% @season_membership_rows.each do |member| %>
          <tr class="d-flex">
            <td class="col-4 text-center pr-5">
              <a href="/profile/<%= member.users_id %>"><%= member.user.username %></a> 
            </td>
            <td class="col-4 text-center pr-5">
              <%= member.category %>
            </td>
            <td class="col-4 text-center pr-5">
              $<%= member.assets.where({ :category => "season_fund"}).at(0).quantity %>
            </td>
          </tr>
                    
          <% end %>
        </table>
      </div>
      <!-- /#sidebar-wrapper -->

    </div>
    <!-- /#wrapper -->
  </div>

  
  <div class="col-6 offset-2">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/my_clubs">My Clubs</a></li>
        <li class="breadcrumb-item"><a href="/clubs/<%= @club_row.id %>"><%= @club_row.title %></a></li>
        <li class="breadcrumb-item"><a href="/seasons/<%= @club_row.id %>/<%= @season_row.id %>"><%= @season_row.title %></a></li>
        <li class="breadcrumb-item active" aria-current="page">Manage Season</li>
      </ol>
    </nav>

    <h1 class="center_title">Manage Season</h1>
    <div class="col-md-8 offset-md-2">
      <div class="jumbotron">
        <h2 class="center_title">Season Details</h2>
          <br>
          <form action="/update_season_details/<%= @club_row.id %>/<%= @season_row.id %>" method="post" enctype="multipart/form-data">
            <div class="form-group">
              <input type="hidden" name="_method" value="patch">
              <label for="update_season_title">What is the new title of your season?</label>
              <input class="form-control" id="update_season_title" type="text" name="updated_season_title" placeholder="Enter a title..." value="<%= @season_row.title %>">
              <br>
              <label for="update_season_description">What is the new description of your season?</label>
              <input class="form-control" id="update_season_description" type="text" name="updated_season_description" placeholder="Enter a description..." value="<%= @season_row.description %>">
              <br>
              <label for="update_season_picture">What picture would you like to set for your Season?</label>
              <input type="file" id="update_season_picture" name="updated_season_picture" class="form-control">
              <!-- Add a password field in the future -->
              <br>
              <br>
              <button class="btn btn-secondary btn-block">Update Season Details</button>
            </div>
          </form>
      </div>
    </div>
    <br>
    <div class="col-md-8 offset-md-2">
      <div class="jumbotron">
        <h2 class="center_title">Add Season Member</h2>
        <br>
          <form action="/add_season_memberships/<%= @club_row.id %>/<%= @season_row.id %>" method="post">
            <div class="form-group">
              <!-- Should probably do this in the controller/model -->
              <label for="select_club_member">Select a member to add from the Club associated with this Season:</label>
              <select class="form-control" required="required" id="select_club_member" name="member_id"><option value="">Select member</option>
                <% @club_membership_rows.each do |club_member| %>
                  <% if Membership.where({ :users_id => club_member.users_id, :clubs_id => club_member.clubs_id, :seasons_id => @season_row.id }).at(0) == nil %>
                    <option value="<%= club_member.users_id %>"><%= club_member.user.username %></option>
                  <% end %>
                <% end %>
              </select>
              <br>
              <label for="select_member_category">Select a role for this new member:</label>
              <select class="form-control" required="required" id="select_member_category" name="member_category"><option value="">Select role for new Season member</option>
                <option value="member">Member</option>
                <option value="admin">Admin</option>
              </select>
              <br>
              <br>
              <button class="btn btn-secondary btn-block">Add Member</button>
            </div>
          </form>
      </div>
    </div>
    <br>
    <div class="col-md-8 offset-md-2">
      <div class="jumbotron">
        <h2 class="center_title">Manage User Funds</h2>
        <br>
        <div>Current Season Fund Amount: <%= number_to_currency(@season_row.fund) %></div>
        <br>
        <h3 class="center_title">Add (or Remove) Funds for all Users in Season</h3>
        
        <form action="/update_season_funds/<%= @club_row.id %>/<%= @season_row.id %>" method="post">
          <div class="form-group">
            <input type="hidden" name="_method" value="patch">
            <label for="update_season_fund">How much would you like to add to (or subtract from) the season fund?</label>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text">$</span>
              </div>
                <input class="form-control" id="update_season_fund" name="amount_added" placeholder="Enter a dollar amount..." type="number" step=".01" required="required">
              </div>
            <br>
            <button class="btn btn-secondary btn-block">Add (or Remove) Funds</button>
            </div>
        </form>
        <br>
        <br>

        <h3 class="center_title">Change Individual User Funds</h3>
        <table class="table table-hover table-striped">
          <thead class="thead-dark">
            <tr>
              <th>
                Username
              </th>

              <th>
                Role
              </th>

              <th>
                Funds
              </th>

              <th>
                Add Funds
              </th>

              <th>
                Remove Funds
              </th>

              <th>
                View Profile
              </th>
            </tr>
          </thead>
          <% @season_membership_rows.each do |member| %>
          <tr>
            <td>
              <%= member.user.username %>
            </td>
            <td>
              <%= member.category %>
            </td>

            <td>
              $<%= member.assets.where({ :category => "season_fund"}).at(0).quantity %>
            </td>

            <td>
              <form action="/adjust_user_funds/<%= @club_row.id %>/<%= @season_row.id %>/<%= member.user.id %>" method="post">
                <div class="form-group">
                  <input type="hidden" name="_method" value="patch">
                  <input type="hidden" name="adjustment_factor" value="positive">
                  <label for="adjust_user_funds"></label>
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text">$</span>
                    </div>
                  <input class="form-control center_title" id="adjust_user_funds" type="number" name="fund_amount" required>
                  </div>
                  <button class="btn btn-secondary w-100">Add</button>
                </div>
              </form>
            </td>

            <td>
              <form action="/adjust_user_funds/<%= @club_row.id %>/<%= @season_row.id %>/<%= member.user.id %>" method="post">
                <div class="form-group">
                  <input type="hidden" name="_method" value="patch">
                  <input type="hidden" name="adjustment_factor" value="negative">
                  <label for="adjust_user_funds"></label>
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text">$</span>
                    </div>
                  <input class="form-control center_title" id="adjust_user_funds" type="number" name="fund_amount" required>
                  </div>
                  <button class="btn btn-secondary w-100">Remove</button>
                </div>
              </form>
            </td>
              
            <td>
              <a class="nav-link btn btn-secondary" href="/profile/<%= member.users_id %>">User Profile</a>
            </td>
          </tr>
          
          <% end %>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
    $("#menu-toggle").click(function(e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });
</script>
